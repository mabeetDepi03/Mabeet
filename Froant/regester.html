<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>إنشاء حساب - Mabeet</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    <!-- إضافة AOS للحركات -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <!-- إضافة SweetAlert -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <link rel="stylesheet" href="./css/styles.css">
</head>
<body>
    <div id="navbar-placeholder"></div>

    <div class="page-header">
        <div class="container">
            <h1 data-aos="fade-down" data-aos-duration="800">إنشاء حساب جديد</h1>
            <nav aria-label="breadcrumb" data-aos="fade-down" data-aos-duration="800" data-aos-delay="200">
                <ol class="breadcrumb justify-content-center">
                    <li class="breadcrumb-item"><a href="index.html">الرئيسية</a></li>
                    <li class="breadcrumb-item active" aria-current="page">إنشاء حساب</li>
                </ol>
            </nav>
        </div>
    </div>

    <main class="container my-5">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="card shadow-sm" data-aos="fade-up" data-aos-duration="800">
                    <div class="card-body p-4">
                        <h3 class="card-title text-center mb-4">اختر نوع الحساب</h3>
                        
                        <div class="row text-center mb-4">
                            <div class="col-md-3 mb-3" data-aos="fade-up" data-aos-duration="600" data-aos-delay="100">
                                <div class="user-type-card" data-type="student">
                                    <i class="fas fa-graduation-cap fa-3x mb-3"></i>
                                    <h5>طالب</h5>
                                    <p>ابحث عن سكن طلابي مناسب</p>
                                </div>
                            </div>
                            <div class="col-md-3 mb-3" data-aos="fade-up" data-aos-duration="600" data-aos-delay="200">
                                <div class="user-type-card" data-type="regular">
                                    <i class="fas fa-user fa-3x mb-3"></i>
                                    <h5>مستخدم عادي</h5>
                                    <p>ابحث عن إقامة لفترة قصيرة</p>
                                </div>
                            </div>
                            <div class="col-md-3 mb-3" data-aos="fade-up" data-aos-duration="600" data-aos-delay="300">
                                <div class="user-type-card" data-type="hotel_owner">
                                    <i class="fas fa-hotel fa-3x mb-3"></i>
                                    <h5>صاحب فندق</h5>
                                    <p>أضف عقاراتك للإيجار</p>
                                </div>
                            </div>
                            <div class="col-md-3 mb-3" data-aos="fade-up" data-aos-duration="600" data-aos-delay="400">
                                <div class="user-type-card" data-type="broker">
                                    <i class="fas fa-handshake fa-3x mb-3"></i>
                                    <h5>وسيط عقاري</h5>
                                    <p>ادمج عقاراتك في منصتنا</p>
                                </div>
                            </div>
                        </div>

                        <form id="registerForm" class="d-none" data-aos="fade-up" data-aos-duration="800" data-aos-delay="500">
                            <div id="hotelOwnerFields" class="d-none">
                                <h4 class="mb-3">معلومات الفندق/العقار</h4>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="hotelName" class="form-label">اسم الفندق/العقار</label>
                                        <input type="text" class="form-control" id="hotelName">
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="licenseNumber" class="form-label">رقم الترخيص</label>
                                        <input type="text" class="form-control" id="licenseNumber">
                                    </div>
                                </div>
                            </div>

                            <div id="brokerFields" class="d-none">
                                <h4 class="mb-3">معلومات الوساطة العقارية</h4>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="agencyName" class="form-label">اسم الوكالة</label>
                                        <input type="text" class="form-control" id="agencyName">
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="brokerLicense" class="form-label">رقم ترخيص الوساطة</label>
                                        <input type="text" class="form-control" id="brokerLicense">
                                    </div>
                                </div>
                            </div>

                            <h4 class="mb-3">معلومات شخصية</h4>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="firstName" class="form-label">الاسم الأول</label>
                                    <input type="text" class="form-control" id="firstName" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="lastName" class="form-label">الاسم الأخير</label>
                                    <input type="text" class="form-control" id="lastName" required>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="email" class="form-label">البريد الإلكتروني</label>
                                <input type="email" class="form-control" id="email" required>
                            </div>

                            <div class="mb-3">
                                <label for="phone" class="form-label">رقم الهاتف</label>
                                <input type="tel" class="form-control" id="phone" required>
                            </div>

                            <div class="mb-3">
                                <label for="password" class="form-label">كلمة المرور</label>
                                <input type="password" class="form-control" id="password" required>
                            </div>

                            <div class="mb-3">
                                <label for="confirmPassword" class="form-label">تأكيد كلمة المرور</label>
                                <input type="password" class="form-control" id="confirmPassword" required>
                            </div>

                            <div class="mb-3 form-check">
                                <input type="checkbox" class="form-check-input" id="agreeTerms" required>
                                <label class="form-check-label" for="agreeTerms">أوافق على <a href="terms.html">شروط الخدمة</a> و <a href="privacy.html">سياسة الخصوصية</a></label>
                            </div>

                            <button type="submit" class="btn btn-primary w-100">إنشاء حساب</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div id="footer-placeholder"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- إضافة مكتبة AOS -->
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <!-- إضافة مكتبة SweetAlert -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.js"></script>
  <script src="./js/auth.js"></script>
    <script src="./js/components.js"></script>
    <script src="./js/shared.js"></script>
    <script>
        // تهيئة AOS
        AOS.init({
            duration: 800,
            once: true,
            offset: 100
        });

        // تحميل المكونات
        document.getElementById('navbar-placeholder').innerHTML = MabeetComponents.createNavbar();
        document.getElementById('footer-placeholder').innerHTML = MabeetComponents.createFooter();

        // معالجة اختيار نوع المستخدم
        const userTypeCards = document.querySelectorAll('.user-type-card');
        const registerForm = document.getElementById('registerForm');
        const hotelOwnerFields = document.getElementById('hotelOwnerFields');
        const brokerFields = document.getElementById('brokerFields');
        let selectedUserType = '';

        userTypeCards.forEach(card => {
            card.addEventListener('click', function() {
                // إزالة التحديد من جميع البطاقات
                userTypeCards.forEach(c => c.classList.remove('selected'));
                
                // إضافة التحديد للبطاقة المختارة
                this.classList.add('selected');
                
                // حفظ النوع المختار
                selectedUserType = this.getAttribute('data-type');
                
                // إظهار النموذج
                registerForm.classList.remove('d-none');
                
                // إظهار/إخفاء الحقول الإضافية حسب النوع
                hotelOwnerFields.classList.add('d-none');
                brokerFields.classList.add('d-none');
                
                if (selectedUserType === 'hotel_owner') {
                    hotelOwnerFields.classList.remove('d-none');
                } else if (selectedUserType === 'broker') {
                    brokerFields.classList.remove('d-none');
                }
            });
        });

        // معالجة إرسال النموذج
        document.getElementById('registerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // التحقق من تطابق كلمات المرور
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (password !== confirmPassword) {
                Swal.fire({
                    icon: 'error',
                    title: 'خطأ',
                    text: 'كلمات المرور غير متطابقة',
                    confirmButtonText: 'حاول مرة أخرى'
                });
                return;
            }
            
            // جمع البيانات
            const userData = {
                firstName: document.getElementById('firstName').value,
                lastName: document.getElementById('lastName').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                password: password,
                userType: selectedUserType
            };
            
            // إضافة البيانات الإضافية حسب النوع
            if (selectedUserType === 'hotel_owner') {
                userData.hotelName = document.getElementById('hotelName').value;
                userData.licenseNumber = document.getElementById('licenseNumber').value;
            } else if (selectedUserType === 'broker') {
                userData.agencyName = document.getElementById('agencyName').value;
                userData.brokerLicense = document.getElementById('brokerLicense').value;
            }
            
            // التسجيل
            if (MabeetAuth.register(userData)) {
                Swal.fire({
                    icon: 'success',
                    title: 'تم بنجاح',
                    text: 'تم إنشاء الحساب بنجاح!',
                    confirmButtonText: 'متابعة',
                    timer: 3000,
                    timerProgressBar: true
                }).then(() => {
                    window.location.href = 'profile.html';
                });
            } else {
                Swal.fire({
                    icon: 'error',
                    title: 'خطأ',
                    text: 'حدث خطأ أثناء إنشاء الحساب. يرجى التحقق من البيانات والمحاولة مرة أخرى.',
                    confirmButtonText: 'حاول مرة أخرى'
                });
            }
        });

        // معالجة تسجيل الخروج
        document.addEventListener('click', function(e) {
            if (e.target && e.target.id === 'logoutBtn') {
                e.preventDefault();
                Swal.fire({
                    title: 'تأكيد تسجيل الخروج',
                    text: 'هل أنت متأكد من رغبتك في تسجيل الخروج؟',
                    icon: 'question',
                    showCancelButton: true,
                    confirmButtonText: 'نعم، تسجيل خروج',
                    cancelButtonText: 'إلغاء'
                }).then((result) => {
                    if (result.isConfirmed) {
                        MabeetAuth.logout();
                        // إعادة تحميل الشريط العلوي
                        document.getElementById('navbar-placeholder').innerHTML = MabeetComponents.createNavbar();
                        Swal.fire({
                            icon: 'success',
                            title: 'تم تسجيل الخروج',
                            text: 'تم تسجيل خروجك بنجاح',
                            timer: 2000,
                            showConfirmButton: false
                        }).then(() => {
                            window.location.href = 'index.html';
                        });
                    }
                });
            }
        });
    </script>
</body>
</html>